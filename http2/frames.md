# 4.HTTP帧
HTTP/2连接一旦建立，端点之间可以马上交换数据帧。

## 4.1帧格式
所有的帧都以固定的9个字节长度的报头开头,后跟可变长度的有效载荷.
```xml
 +-----------------------------------------------+
 |                 Length (24)                   |
 +---------------+---------------+---------------+
 |   Type (8)    |   Flags (8)   |
 +-+-------------+---------------+-------------------------------+
 |R|                 Stream Identifier(流标识符) (31)             |
 +=+=============================================================+
 |                   Frame Payload(帧有效载荷) (0...)            ...
 +---------------------------------------------------------------+
```
帧报头字段定义是：
- Length：帧主题的长度表示为无符号的24位整数.不得发送大于214(16384)的值,除非接收端已为SETTINGS_MAX_FRAME_SIZE设置了较大的值。9字节长度的帧报头信息不计算在此内。
- type: 帧的8位类型。帧类型定义了剩余的帧报头和帧主体将如何被解释。具体实现必须在收到未知帧类型(任何未在文档中定义的帧)时作为连接错误中的类型协议错误(PROTOCOL_ERROR)处理。
- flags: 为帧类型保留的8字节字段有具体的布尔标识。 标识针对确定的帧类型赋予特定的语义。确定帧类型定义语义以外的标示必须被忽略，并且必须在发送的时候保留未设置(0x0)。
- R: 保留的1位字段。这些字节的语义是未定义的，并且在发送的时候必须保持未设置(0x0)，接收的时候必须被忽略此字段。
- Stream Identifier:流标识符（见第5.1.1节），表示为无符号31位整数。值0x0保留用于与整个连接相关联的帧，而不是单个流。

帧有效载荷的结构和内容完全取决于帧类型。

## 4.2 帧大小
帧主题的大小受接收端在广播中设置的SETTINGS_MAX_FRAME_SIZE的值限制.该值介于214（16,384）和224-1（16,777,215）个字节之间的任何值。

所有实现必须能够接收和最小处理长度214位字节的帧，以及9位字节的帧头（见第4.1节）。当描述帧大小时，不包括帧头的大小。

注意：某些帧类型（例如PING（第6.7节））对允许的有效负载数据量施加了额外的限制。

如果帧超过SETTINGS_MAX_FRAMES_SIZE中定义的大小,超过为帧类型定义的任何限制,或者太小而不能包含必须的帧数据，则端点必须发送帧大小错误(FRAME_SIZE_ERROR)的错误代码。帧中的帧大小错误可能改变整个连接的状态必须被当作连接错误（见第5.4.1节）。这包括携带报头区块（第4.3节）（即，HEADERS，PUSH_PROMISE和CONTINUATION），SETTINGS和任何具有流标识符0的帧的任何帧。

端点没有义务使用框架中的所有可用空间。可以通过使用小于允许的最大大小的帧来提高响应性。发送大帧可能会导致发送时间敏感帧（例如RST_STREAM，窗口更新(WINDOW_UPDATE)或优先级(PRIORITY)）的延迟，如果被大帧的传输阻止，则可能会影响性能。

## 4.3 报头压缩和解压缩
与HTTP/1中一样，HTTP/2中的header字段是具有一个或多个关联值的名称。header字段在HTTP请求和响应消息以及服务器推送操作中使用（参见第8.2节）。

报头集合是0个或多个报头字段的集合。当他通过连接传输的时候，报头集合将使用HTTP报头压缩序列化到报文报头块中。序列化的报头块被分割成一个或多个的字节序列，称为报头分区，并在报头(HEADERS)、推送承诺(PUSH_PROMISE)及延续(CONTINUATION)帧的载体中传送。

报文头Cookie字段被通过HTTP映射特殊处理；见章节8.1.2.5。

接收端点连接报头区块重新组装，并且解压缩区块后重建报头集合。

一个完整的报头区块包含：
- 一个包含报头终止标记集合的单独的报头HEADERS 或 推送承诺PUSH_PROMISE帧，或者
- 一个报头终止标记被清除的报头HEADERS 或 推送承诺PUSH_PROMISE帧以及一个或多个延续CONTINUATION帧，最后一个延续CONTINUATION帧拥有报头终止标记设置





